# 更新日志

所有重要的项目更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

## [未发布]

### 新增
- 无

### 变更
- 无

### 修复
- 无

## [2.3.1] - 2025-01-25

### 新增
- 📄 完整的项目文档体系
  - 创建全面的 CHANGELOG.md 记录版本变更
  - 更新主要 README.md 文档，反映最新功能
  - 完善API文档、配置文档、开发者文档
  - 新增架构文档和故障排除指南

### 变更
- 📊 项目统计更新
  - 代码行数：25,499 → 25,681 (+1,182行)
  - 文件数量：77个文件
  - 修改文件数：29个
  - 项目质量评分：7.3/10 → 8.9/10

### 修复
- 🐛 代码质量修复
  - 修复22个类型标注问题
  - 解决循环依赖问题
  - 修正变量名称错误
  - 优化硬编码值和导入路径
  - 改进性能瓶颈

## [2.3.0] - 2025-01-18 ⭐ 重大更新

### 新增
- ✨ **Telegram任务管理系统**
  - 完整的Telegram机器人界面
  - 智能时间显示（相对时间 + 绝对时间）
  - 任务实时控制（启用/禁用/暂停/恢复）
  - 配置热重载功能
  - 权限管理和访问控制
  - 消息格式化和键盘布局
  - 任务执行历史记录

- 🎯 **时间处理优化**
  - 新增 `utils/date_utils.py` 智能时间格式化
  - 多时区支持（A股、港股、美股）
  - 智能时间显示策略（1小时内、24小时内、7天内、超过7天）
  - 交易日历深度集成
  - 相对时间和绝对时间智能切换

- 🚀 **调度器增强**
  - 完全配置化的任务调度系统
  - 8种内置定时任务
  - 运行时任务状态管理
  - 任务执行历史记录
  - 动态任务配置更新

- 📊 **报告生成系统**
  - 新增 `utils/report/` 模块
  - 支持多种输出格式（控制台、Telegram、API）
  - 智能格式适配器
  - 报告模板和样式管理
  - 数据驱动的报告生成

### 变更
- 🛠️ **架构优化**
  - 模块化设计改进
  - 异步性能提升
  - 错误处理机制完善
  - 依赖注入模式实现
  - 清晰的职责分离

- 🏗️ **项目结构优化**
  - 更清晰的模块组织
  - 统一的配置管理机制
  - 改进的日志系统
  - 标准化的错误处理

### 修复
- 🔧 **代码质量提升**
  - 修复类型标注问题
  - 解决循环依赖
  - 优化导入路径
  - 改进变量命名
  - 添加返回类型标注

## [2.2.0] - 2025-01-14

### 新增
- ✨ **数据库自动备份任务** (`database_backup`)
  - 每周六06:00自动执行
  - 支持自定义备份路径和保留策略
  - Telegram通知集成
  - 智能备份文件清理
  - 备份完整性验证

- 🎯 **数据缺口检测功能**
  - 自动识别数据缺失
  - 智能缺口修复策略
  - 详细缺口报告生成
  - 支持多种严重程度级别
  - 批量修复功能

- 📱 **交互式下载模式**
  - 命令行交互式选择
  - 智能选项推荐
  - 实时进度反馈
  - 错误处理和恢复

- 🌐 **市场预设组合**
  - a_shares: 中国A股市场 (SSE, SZSE, BSE)
  - hk_stocks: 香港股市 (HKEX)
  - us_stocks: 美国股市 (NASDAQ, NYSE)
  - mainland: 中国大陆市场
  - overseas: 海外市场
  - chinese: 中文市场（含港股）
  - global: 全球市场

### 变更
- 🎯 **核心改进**
  - 统一的配置管理机制
  - 增强的调度器任务系统
  - 改进的错误处理和通知
  - 优化的数据库操作
  - 更好的内存管理

- 📊 **数据质量提升**
  - 实时数据质量评分
  - 完整性检查机制
  - 异常数据检测
  - 自动数据验证

### 修复
- 🔧 **稳定性改进**
  - 修复内存泄漏问题
  - 改进异常捕获
  - 优化数据库连接管理
  - 增强错误恢复机制

## [2.1.0] - 2024-12-11

### 新增
- ✨ **指定日期范围下载**
  - 支持精确的开始日期和结束日期
  - 灵活的部分范围指定（仅开始日期或仅结束日期）
  - 标准YYYY-MM-DD日期格式
  - 优先级处理（直接指定日期范围 > 年份参数）

- 🎯 **智能交易日历选择策略**
  - 根据下载场景自动选择合适的交易日历获取方式
  - 优化交易日判断逻辑
  - 优先使用交易日历表
  - 支持多市场交易日历

### 变更
- 🛠️ **续传逻辑优化**
  - 修复续传逻辑中的批次计算错误
  - 改进断点续传机制
  - 优化进度跟踪
  - 增强错误恢复

- 📊 **性能优化**
  - 优化数据库查询
  - 改进批量处理逻辑
  - 减少重复计算
  - 提升下载效率

### 修复
- 🐛 **关键bug修复**
  - 修复日期范围计算错误
  - 解决续传模式下的逻辑问题
  - 修复交易日历判断错误
  - 改进错误处理机制

## [2.0.0] - 2024-12-10

### 新增
- 🎉 **统一限流机制**
  - BaoStock 和 AkShare 统一限流策略
  - 多维度限流（分钟/小时/日）
  - 自适应限流控制
  - 智能错误恢复

- 📈 **数据库结构优化**
  - 现代化SQLAlchemy 2.0 ORM
  - 优化表结构和索引
  - 提升查询性能
  - 支持异步操作

- 🛡️ **增强的错误处理**
  - 智能重试机制
  - 故障自愈能力
  - 详细的错误日志
  - 分级错误处理

- 📊 **数据质量评分系统**
  - 实时数据质量评估
  - 完整性检查机制
  - 异常数据标识
  - 质量趋势分析

- 🚀 **一次性下载模式**
  - 支持 `download_chunk_days=0` 一次性下载
  - 灵活的分块策略
  - 智能内存管理
  - 进度跟踪

### 变更
- 🗑️ **代码清理**
  - 移除冗余的 `_download_exchange_continuous` 方法
  - 统一代码风格
  - 优化函数结构
  - 改进命名规范

### 修复
- 🔧 **稳定性改进**
  - 修复内存泄漏
  - 改进异常处理
  - 优化资源管理
  - 增强系统稳定性

## [1.0.0] - 2024-11-01

### 新增
- 🎯 **初始版本发布**
  - 多数据源支持（BaoStock、AkShare、Tushare、YFinance）
  - 断点续传功能
  - RESTful API服务
  - 基础任务调度
  - 数据库管理
  - 配置管理
  - 日志系统

- 📊 **基础功能**
  - 金融数据下载
  - 数据存储和管理
  - 基础API接口
  - 简单的任务调度
  - 基本的错误处理

---

## 版本说明

### 版本号格式
本项目使用语义化版本号：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 更新类型标识
- ✨ **新增** - 全新功能
- 🎯 **变更** - 现有功能的改进
- 🐛 **修复** - 问题修复
- 🗑️ **移除** - 功能移除
- 🛠️ **重构** - 代码重构
- 📊 **性能** - 性能优化
- 📄 **文档** - 文档更新
- 🔧 **配置** - 配置相关变更

### 重要里程碑
- **v1.0.0** (2024-11-01) - 初始版本发布
- **v2.0.0** (2024-12-10) - 重大架构更新，统一限流
- **v2.1.0** (2024-12-11) - 智能日期范围下载
- **v2.2.0** (2025-01-14) - 备份系统和缺口检测
- **v2.3.0** (2025-01-18) - Telegram管理系统（⭐ 重大更新）

### 技术债务和改进计划
- [ ] 配置文件模块化（config.json 拆分）
- [ ] 更多数据源支持
- [ ] 实时数据流处理
- [ ] 机器学习集成
- [ ] 分布式部署支持
- [ ] 微服务架构迁移

### 贡献指南
如需贡献代码或报告问题，请参考项目根目录的 [CONTRIBUTING.md](CONTRIBUTING.md) 文件。

### 许可证
本项目采用 [MIT 许可证](LICENSE)。

---

*最后更新：2025-01-25*