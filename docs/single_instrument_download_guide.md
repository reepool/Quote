# 指定股票下载功能使用指南

## 功能概述

新增的指定股票下载功能允许您精确地下载某只特定股票的历史数据，而无需下载整个交易所或市场的数据。

## 命令语法

```bash
python main.py download --instrument-id <股票代码> --start-date <开始日期> --end-date <结束日期>
```

## 必需参数

| 参数 | 格式 | 说明 | 示例 |
|------|------|------|------|
| `--instrument-id` | 字符串 | 股票代码，格式为数字.交易所 | `000001.SZSE` |
| `--start-date` | 日期 | 开始日期，格式YYYY-MM-DD | `2024-01-01` |
| `--end-date` | 日期 | 结束日期，格式YYYY-MM-DD | `2024-12-31` |

## 可选参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `--no-resume` | 标志 | False | 禁用续传模式，重新下载所有数据 |

## 支持的股票代码格式

| 交易所 | 代码格式 | 示例 |
|--------|----------|------|
| 上海证券交易所 (SSE) | 6位数字.SSE | `600000.SSE` |
| 深圳证券交易所 (SZSE) | 6位数字.SZSE | `000001.SZSE` |
| 北京证券交易所 (BSE) | 6位数字.BSE | `430047.BSE` |
| 香港交易所 (HKEX) | 5位数字.HKEX | `00700.HKEX` |
| 纳斯达克 (NASDAQ) | 4-5位字母.NASDAQ | `AAPL.NASDAQ` |
| 纽约证券交易所 (NYSE) | 1-4位字母.NYSE | `IBM.NYSE` |

## 使用示例

### 1. 下载平安银行历史数据
```bash
python main.py download --instrument-id 000001.SZSE --start-date 2024-01-01 --end-date 2024-12-31
```

### 2. 下载贵州茅台历史数据
```bash
python main.py download --instrument-id 600519.SSE --start-date 2023-01-01 --end-date 2024-12-31
```

### 3. 下载腾讯控股历史数据
```bash
python main.py download --instrument-id 00700.HKEX --start-date 2024-01-01 --end-date 2024-12-31
```

### 4. 强制重新下载（忽略已有数据）
```bash
python main.py download --instrument-id 000001.SZSE --start-date 2024-01-01 --end-date 2024-12-31 --no-resume
```

### 5. 下载新上市股票数据
```bash
python main.py download --instrument-id 301632.SZSE --start-date 2025-08-01 --end-date 2025-10-12
```

## 执行流程

### 1. 参数验证
- 验证股票代码格式是否正确
- 检查日期范围是否合理
- 确保必需参数都已提供

### 2. 股票信息验证
- 查询数据库中是否存在该股票
- 显示股票基本信息（名称、交易所、上市日期）

### 3. 数据下载
- 获取指定日期范围的交易日历
- 检查已有数据，避免重复下载
- 分批下载缺失的数据（每批50天）

### 4. 结果统计
- 显示下载记录数量
- 展示数据时间范围
- 检测并报告数据缺口

## 输出示例

### 成功下载示例
```
🔍 开始下载指定股票数据:
   股票代码: 000001.SZSE
   日期范围: 2024-01-01 到 2024-12-31
   续传模式: 开启
   股票名称: 平安银行
   交易所: SZSE
   上市日期: 1991-04-03

✅ 股票 000001.SZSE 数据下载完成!

📊 下载统计:
   总记录数: 243
   数据范围: 2024-01-02 到 2024-12-31
   数据完整性: ✅ 无缺口
```

### 发现缺口的示例
```
✅ 股票 600000.SSE 数据下载完成!

📊 下载统计:
   总记录数: 218
   数据范围: 2024-01-02 到 2024-12-31
   数据缺口: 2 个
      2024-01-15 到 2024-01-16 (2天)
      2024-05-01 到 2024-05-01 (1天)
```

## 错误处理

### 常见错误及解决方案

1. **无效的股票代码格式**
   ```
   错误: 无效的股票代码格式 '000001'
   正确格式示例: 000001.SZSE, 600000.SSE
   ```
   **解决方案**: 确保股票代码包含交易所后缀

2. **找不到股票代码**
   ```
   错误: 找不到股票代码 '999999.SZSE'
   提示: 请检查股票代码是否正确，或先下载对应交易所的股票列表
   ```
   **解决方案**: 检查股票代码是否正确，或先下载对应交易所的股票列表

3. **缺少必需参数**
   ```
   错误: 使用 --instrument-id 时必须指定 --start-date 和 --end-date
   ```
   **解决方案**: 确保提供开始和结束日期

4. **日期格式错误**
   ```
   错误: 开始日期格式无效，请使用 YYYY-MM-DD 格式
   ```
   **解决方案**: 使用正确的日期格式，如 2024-01-01

## 注意事项

1. **数据库依赖**: 使用此功能前，请确保已经下载了对应交易所的股票列表
2. **日期范围**: 建议不要一次性下载过长时间范围（如超过10年），以免影响性能
3. **续传功能**: 默认开启续传，只下载缺失的数据，提高效率
4. **数据质量**: 下载完成后会自动检测数据缺口，便于后续补充

## 配合其他功能使用

### 1. 检测数据缺口
下载完成后，可以使用GAP检测功能检查数据完整性：
```bash
python main.py gap --exchanges SZSE --start-date 2024-01-01 --end-date 2024-12-31 --detailed
```

### 2. 查询下载的数据
通过API查询已下载的数据：
```bash
curl "http://localhost:8000/api/v1/quotes/daily?instrument_id=000001.SZSE&start_date=2024-01-01T00:00:00&end_date=2024-12-31T00:00:00&return_format=json"
```

### 3. 更新最新数据
定期更新最新数据：
```bash
python main.py update --exchanges SZSE
```

## 最佳实践

1. **小范围下载**: 建议按年度下载数据，便于管理和调试
2. **验证数据**: 下载后及时检查数据质量和完整性
3. **定期更新**: 建立定期更新机制，保持数据最新
4. **备份重要**: 对重要股票数据进行定期备份
